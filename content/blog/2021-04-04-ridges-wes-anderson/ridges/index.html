---
title: 'Ridges & Wes Anderson'
layout: single-sidebar
date: '2021-04-04'
slug: 2021-04-04-ridges-wes-anderson/ridges
categories:
  - R
  - Hydrology
tags:
  - R
  - Hydrology
subtitle: 'This is a quick exploration into the {wesanderson} and {ggridges} using USGS daily data.'
summary: 'This is a quick exploration into the {wesanderson} and {ggridges} using USGS daily data.'
authors: []
lastmod: ''
featured: yes
output:
  blogdown::html_page:
    css: "style.css"
image:
  caption: '[Image credit: Josh Erickson](featured.png)'
  placement: 2
  focal_point: 'Center'
  preview_only: no
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>
  <link rel="stylesheet" href="style.css" type="text/css" />


<div id="intro" class="section level1">
<h1>Intro</h1>
<p>I’ve been wanting to use the <a href="https://github.com/karthik/wesanderson">wesanderson</a> package on some hydrological data using ridge plots (<a href="https://github.com/wilkelab/ggridges">ggridges</a>) and today I had the chance to play around and finally make some graphs. So, we’ll just make some basic graphs that hopefully will be aestetically pleasing and get the message across to stake holders, layperson, or others in your circle.</p>
<p>First we’ll need a few packages.</p>
<pre class="r"><code>library(wildlandhydRo)
library(ggridges)
library(wesanderson)
library(tidyverse)</code></pre>
<p>Now let’s get some USGS streamflow data! We’ll grab the daily values for the Yaak River gauging station near Troy, Montana and also grab some annual and monthly stats using some functions in <a href="https://github.com/joshualerickson/wildlandhydRo">wildlandhydRo</a>. The wildlandhydRo package is a wrapper around <a href="">dataRetrieval</a> but does some tidying and extra stats and also can run in parallel which is nice if your grabbing lots of data, e.g. multiple sites.</p>
<pre class="r"><code>yaak_dv &lt;- batch_USGSdv(sites = &#39;12304500&#39;,parameterCd = &#39;00060&#39;)

yaak_my &lt;- yaak_dv %&gt;% wymUSGS()</code></pre>
<p>Sweet, now we have some data we can explore with <code>ggplot2</code> and <code>ggridges</code> to see if there are any density plots that might help us understand the distribution of streamflow at this site.</p>
<p>Let’s start with monthly stats; like, what’s the monthly distribution of daily streamflow at this site? We’ll bring in the daily values and group by month.</p>
<pre class="r"><code>yaak_dv %&gt;% 
  ggplot(aes(Flow, month, group = month)) +
  geom_density_ridges() + theme_ridges() + labs(title = &#39;Monthly Distribution of Daily Flow; Yaak River near Troy, Montana&#39;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-1.png" width="960" /></p>
<p>As you can see, some of the data distributions (months April, May, June) have way different values. This might not be the most aestetically pleasing graph but it does tell us that these months are the high streamflow months on average! What if we just looked at them together? Here, we’ll start to add some color with the <code>wesanderson</code> palette.</p>
<pre class="r"><code>yaak_dv %&gt;% filter(month %in% c(4,5,6)) %&gt;%
  ggplot(aes(Flow, month_abb,  fill = stat(x))) +
  geom_density_ridges_gradient()+ 
  scale_fill_gradientn(colors = wes_palette(&#39;Darjeeling2&#39;, type = &#39;continuous&#39;)) + theme_ridges()  +
  labs(title = &#39;Apr-Jun Distribution of Daily Flow; Yaak River near Troy, Montana&#39;, y = &#39;Month&#39;, fill = &#39;Mean Flow (cfs)&#39;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-5-1.png" width="960" />
Or, what’s nice with <code>ggridges</code> is overlaying a cdf gradient and add a rug as well.</p>
<pre class="r"><code>yaak_dv %&gt;% filter(month %in% c(4,5,6)) %&gt;%
  ggplot(aes(Flow, month_abb, fill = 0.5 - abs(0.5 - stat(ecdf)))) +
  stat_density_ridges(geom = &quot;density_ridges_gradient&quot;, calc_ecdf = TRUE,
    jittered_points = TRUE,
    position = position_points_jitter(width = 0.05, height = 0),
    point_shape = &#39;|&#39;, point_size = 1, point_alpha = 1) +
  scale_fill_gradientn(colors = wes_palette(&#39;Chevalier1&#39;, type = &#39;continuous&#39;)) + theme_ridges()  +
  labs(title = &#39;Apr-Jun Distribution of Daily Flow; \nYaak River near Troy, Montana&#39;, y = &#39;Month&#39;, fill = &#39;Probability (CDF)&#39;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-6-1.png" width="960" /></p>
<p>Here we can start to see that May has the highest mean Flow and June/April are very similar. What would the other months look like if we left out Apr-Jun? We can do the same as above except leave those months out.</p>
<pre class="r"><code>yaak_dv %&gt;% filter(!month %in% c(4,5,6)) %&gt;%
  ggplot(aes(Flow, month_abb, fill = stat(x))) +
  geom_density_ridges_gradient()+ 
  scale_fill_gradientn(colors = wes_palette(&#39;Chevalier1&#39;, type = &#39;continuous&#39;)) + theme_ridges()  +
  labs(title = &#39;July-March Distribution of Daily Flow; \nYaak River near Troy, Montana&#39;, y = &#39;Month&#39;, fill = &#39;Mean Flow (cfs)&#39;) + scale_x_continuous(limits = c(1,1500))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-7-1.png" width="960" /></p>
<p>Probably not the best graph to do because we are leaving out a chunk of data, i.e. can be misleading… However, you can play with the <code>scale</code> and <code>rel_min_height</code> argument in <code>geom_density_ridges</code> which might make it possible to include all the months while keeping the balance of message and aesthetics. Let’s see.</p>
<pre class="r"><code>yaak_dv %&gt;% 
  group_by(month) %&gt;% mutate(mean_flow = round(mean(Flow),0)) %&gt;% 
  ungroup() %&gt;% 
  ggplot(aes(Flow, month_abb)) +
  geom_density_ridges(aes(fill = mean_flow),scale = 15,rel_min_height = 0.01)+ 
  scale_fill_gradientn(colors = wes_palette(&#39;Zissou1&#39;, type = &#39;continuous&#39;)) + theme_ridges()  +
  labs(title = &#39;Monthly Distribution of Daily Flow; \nYaak River near Troy, Montana&#39;, y = &#39;Month&#39;, fill = &#39;Mean Flow (cfs)&#39;)+ scale_x_continuous(limits = c(-500,12000))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-8-1.png" width="960" /></p>
<p>Not the best but better than the first try. Play around with these arguments a try and strike a balance with the message and looks. Here, we are showing that May is the month with the highest mean flow and that you decrease mean flow the farther you move away.</p>
<p>What about across years? Now that we know what month has the highest mean flow we can also use that to our advantage when plotting by year. But first, let’s see how the daily flow looks over the period of record for this gauging station.</p>
<pre class="r"><code>yaak_dv %&gt;% 
  group_by(wy) %&gt;% mutate(mean_flow = round(mean(Flow),0)) %&gt;% 
  ungroup() %&gt;% 
  ggplot(aes(Flow, wy, group = wy)) +
  geom_density_ridges(aes(fill = mean_flow),scale = 10,rel_min_height = 0.1)+ 
  scale_fill_gradientn(colors = wes_palette(&#39;Rushmore1&#39;, type = &#39;continuous&#39;)) + theme_ridges()  +
  labs(title = &#39;Water Year Distribution of Daily Flow; \nYaak River near Troy, Montana&#39;, y = &#39;Water Year&#39;, fill = &#39;Mean Flow (cfs)&#39;)+ scale_x_continuous(limits = c(1,500))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-9-1.png" width="960" /></p>
<p>This is cool to look at but probably not the most revealing or easy to dissecting anything meaningful. What if we only used Apr-Jun daily flow values and looked at the distributions, would that clear anything up?</p>
<pre class="r"><code>yaak_dv %&gt;% filter(month %in% c(4,5,6)) %&gt;% 
  group_by(wy) %&gt;% mutate(mean_flow = round(mean(Flow),0)) %&gt;% 
  ungroup() %&gt;% 
  ggplot(aes(Flow, wy, group = wy)) +
  geom_density_ridges(aes(fill = mean_flow),scale = 15,rel_min_height = 0.001)+ 
  scale_fill_gradientn(colors = wes_palette(&#39;Darjeeling2&#39;, type = &#39;continuous&#39;)) + theme_ridges()  +
  labs(title = &#39;Water Year Distribution of Daily Flow; \nYaak River near Troy, Montana&#39;,subtitle = &#39;Mean Flow for Apr-Jun&#39;, y = &#39;Water Year&#39;, fill = &#39;Mean Flow (cfs)&#39;)+ scale_x_continuous(limits = c(-500,10000))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-10-1.png" width="960" /></p>
<p>Still not the best, so what if we faceted by month!? Let’s try that and see if there are any patterns in streamflow distributions.</p>
<pre class="r"><code>yaak_dv %&gt;% filter(month %in% c(3,4,5,6,7,8)) %&gt;%  
  ggplot(aes(Flow, wy, group = wy, fill = stat(x))) +
  geom_density_ridges_gradient(scale = 25,rel_min_height = 0.1)+ 
  scale_fill_gradientn(colors = wes_palette(&#39;Darjeeling2&#39;, type = &#39;continuous&#39;)) + 
theme_ridges() + 
  labs(title = &#39;Water Year Distribution of Daily Flow; \nYaak River near Troy, Montana&#39;, y = &#39;Water Year&#39;, fill = &#39;Mean Flow (cfs)&#39;, subtitle = &#39;broken into months&#39;) + facet_wrap(~month_abb, scales = &#39;free&#39;, ncol = 2)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-11-1.png" width="960" /></p>
<p>This is somewhat more revealing, especially the later summer distributions. It almost looks like July and August are lower than in the past. Let’s look at August.</p>
<pre class="r"><code>yaak_dv %&gt;% filter(month %in% c(8)) %&gt;% 
  group_by(wy) %&gt;% mutate(mean_flow = round(mean(Flow),0)) %&gt;% 
  ungroup() %&gt;% 
  ggplot(aes(Flow, wy, group = wy)) +
  geom_density_ridges(aes(fill = mean_flow))+ 
  scale_fill_gradientn(colors = wes_palette(&#39;Cavalcanti1&#39;, type = &#39;continuous&#39;)) + theme_ridges(grid = F)  +
  labs(title = &#39;Water Year Distribution of Daily Flow \nby in August; Yaak River near Troy, Montana&#39;, y = &#39;Water Year&#39;, fill = &#39;Mean Flow (cfs)&#39;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-12-1.png" width="960" /></p>
<p>Ok, now let’s look at it with a scatterplot. We’ll use the <code>yaak_my</code> data we grabbed at the beginning. Be careful when applying smoothing parameters and always remember to be in ‘exploratory’ mode not ‘confirmatory’ mode.</p>
<pre class="r"><code>yaak_my %&gt;% filter(month_abb == &#39;Aug&#39;) %&gt;% 
  pivot_longer(c(&#39;Maximum&#39;, &#39;Minimum&#39;, &#39;Median&#39;)) %&gt;% 
  ggplot(aes(wy, value, color = name)) + geom_line() + 
  scale_color_manual(values = wes_palette(&#39;Darjeeling1&#39;)) +
  geom_smooth() + 
  facet_wrap(~name, scales = &#39;free&#39;) + 
  labs(color = &#39;Stats&#39;, title = &#39;Period of Record August Stats at \nYaak River near Troy, MT&#39;, y = &#39;Discharge (cfs)&#39;, x = &#39;Water Year&#39;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-13-1.png" width="960" /></p>
<pre class="r"><code>library(ggstream)

yaak_my %&gt;% filter(month_abb == &#39;Aug&#39;) %&gt;% 
  pivot_longer(c(&#39;Maximum&#39;, &#39;Minimum&#39;, &#39;Median&#39;, &#39;Mean&#39;)) %&gt;% 
  ggplot(aes(wy, value, fill = name, color = name, label = name)) + 
    geom_stream(extra_span = 0.013,bw = 0.8, type = &quot;ridge&quot;, n_grid = 3000) +
    geom_stream_label(size = 4, type = &quot;ridge&quot;, n_grid = 1000) +
  cowplot::theme_minimal_vgrid(font_size = 12) +
  theme(legend.position = &quot;none&quot;) +
  scale_colour_manual(values = wes_palette(&#39;Chevalier1&#39;) %&gt;% colorspace::darken(.8)) +
  scale_fill_manual(values =  wes_palette(&#39;Chevalier1&#39;)  %&gt;% colorspace::lighten(.2))+
  labs(title = &#39;Period of Record August Stats at \nYaak River near Troy, MT&#39;, y = &#39;Discharge (cfs)&#39;, x = &#39;Water Year&#39;) </code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-14-1.png" width="960" />
<img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-15-1.png" width="960" /></p>
<p>So, this leads us to more exploration and doing more time series analysis but for now we’ll just end this dive into <code>ggridges</code> and the <code>wesanderson</code> packages. Have a good one!</p>
</div>
