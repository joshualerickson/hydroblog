<!DOCTYPE html>
<html lang="en" dir="ltr"><head>
  
                           
     


<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.87.0" />
<title>ANOVA | hydroblog</title>


<meta property="twitter:site" content="@joshualerickson">
<meta property="twitter:creator" content="@joshualerickson">







  
    
  
<meta name="description" content="A look into ANOVA. The long way.">


<meta property="og:site_name" content="hydroblog">
<meta property="og:title" content="ANOVA | hydroblog">
<meta property="og:description" content="A look into ANOVA. The long way." />
<meta property="og:type" content="page" />
<meta property="og:url" content="https://hydroblog.netlify.com/blog/anova/anova/2021-08-17/" />
<meta property="og:locale" content="en">




    
        <meta property="og:image" content="https://hydroblog.netlify.com/blog/anova/anova/2021-08-17/featured.png" >
        <meta property="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="https://hydroblog.netlify.com/blog/anova/anova/2021-08-17/featured.png" >
    
    
  <meta itemprop="name" content="ANOVA">
<meta itemprop="description" content="A look into ANOVA. The long way."><meta itemprop="datePublished" content="2021-08-17T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-08-17T00:00:00+00:00" />
<meta itemprop="wordCount" content="1561"><meta itemprop="image" content="https://hydroblog.netlify.com/blog/anova/anova/2021-08-17/featured.png">
<meta itemprop="keywords" content="R," />
  
  <!--[if IE]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="shortcut icon" href="/img/water.ico" type="image/x-icon">
  <link rel="icon" href="/img/water.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/style.main.min.5477c20f89738a32763391bbc2f43dbdfc2db0e7faba550c86cac92c99efa6b6.css" integrity="sha256-VHfCD4lzijJ2M5G7wvQ9vfwtsOf6ulUMhsrJLJnvprY=" media="screen">
  
  
  <script src="/panelset.min.078a92db9bd3228df502db3d9e0453c3cf3d910abe3f8deca0ad196c7071ad41.js" type="text/javascript"></script>
  
  
  <script src="/main.min.0fe7313cc594fa307cdf603bcf065f456b2b2539a1f686ce5f3445d01e702a8d.js" type="text/javascript"></script>
</head>
<body>
      <div class="grid-container single-sidebar">
<header class="site-header pt4 pb2 mb4 bb b--transparent ph5 headroom z-max" role="banner">
  <nav class="site-nav db dt-l w-100" role="navigation">
    <a class="site-brand db dtc-l v-mid link no-underline w-100 w-33-l tc tl-l" href="https://hydroblog.netlify.com/" title="Home">
      <img src="/img/water_blue.png" class="dib db-l h2 w-auto" alt="hydroblog">
    </a>
    <div class="site-links db dtc-l v-mid w-100 w-47-l tc tr-l mt3 mt0-l ttu tracked">
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/about/" title="About hydroblog">About</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 active" href="/blog/" title="Blog">Blog</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/project/" title="Project Portfolio">Projects</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/talk/" title="Talks">Talks</a>
      
      
    </div>
  </nav>
</header>

<main class="page-main pa4" role="main">
  <section class="page-content mw7 center">
    <article class="post-content pa0 pr3-l">
      <header class="post-header">
        <h1 class="f1 lh-solid measure-narrow mb3 fw4">ANOVA</h1>
        <h4 class="f4 mt0 mb4 lh-title measure">A look into ANOVA. The long way.</h4>
        <p class="f6 measure lh-copy mv1">By Josh Erickson in <a href="https://hydroblog.netlify.com/categories/r">R</a>  <a href="https://hydroblog.netlify.com/categories/hydrology">Hydrology</a>  <a href="https://hydroblog.netlify.com/categories/statistics">Statistics</a> </p>
        <p class="f7 db mv0 ttu">August 17, 2021</p>
      </header>
      <section class="post-body pt5 pb4">
        
<script src="https://hydroblog.netlify.com/blog/anova/anova/2021-08-17/index_files/header-attrs/header-attrs.js"></script>
<script src="https://hydroblog.netlify.com/blog/anova/anova/2021-08-17/index_files/kePrint/kePrint.js"></script>
<link href="https://hydroblog.netlify.com/blog/anova/anova/2021-08-17/index_files/lightable/lightable.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" type="text/css" />


<div id="intro" class="section level2">
<h2>Intro</h2>
<p>In this blog post we will dive into ANOVA aka Analysis of Variance and see how we derive the final output from a function like <code>anova()</code> by using packages like {tidyverse}. ANOVA is a OG when it comes to statistics and comparing multiple groups of data. It can seem weird at first but since it goes hand-in-hand with regression I think it makes it less scary. In this blog post we will go over one-way ANOVA. We want to start with some groups of data like wind-speed at multiple stations or mean annual flows for August at multiple gauging stations. Once we have this we can start performing ANOVA.</p>
</div>
<div id="eda" class="section level2">
<h2>EDA</h2>
<p>Let’s bring in some data and explore! This data is from three different weather stations and the random variable is wind speed. This is a perfect time to use the <code>tribble()</code> from which we can create a tibble. We’ll also pivot the locations so that we can use for plotting and grouping.</p>
<pre class="r"><code>library(tidyverse)
wind_speed &lt;- tribble(
  ~loc_1, ~loc_2, ~loc_3, ~month,
  2.21,0.87,1.89, 1,
  0.62, 1.65, 3.03, 2,
  2.03, 0.74, 1.85, 3,
  0.8, 3.52, -0.29, 4,
  0.84, 2.27, 0.68, 5,
  1.52, 2.15, 2.76, 6,
  0.57, 1.33, 1.03, 7,
  1.39, 1.87, 0.88, 8,
  2.3, 1.93, 1.03, 9,
  1.78, 2.48, 2.49, 10,
  2.17, 1.44, 0.88, 11,
  1.72, 1.03, 1.17, 12
)

wind_speed_piv &lt;- wind_speed %&gt;% pivot_longer(cols = contains(&#39;loc&#39;))</code></pre>
<p>Now if we plot these groups out we can see visually what they look like together.</p>
<p><img src="https://hydroblog.netlify.com/blog/anova/anova/2021-08-17/index_files/figure-html/unnamed-chunk-3-1.png" width="960" /></p>
<p>I mean they seem similar? This is where the eye-ball test fails big time (even for seemingly different boxplots i.e. 95% CI don’t overlap). Welcome ANOVA. ANOVA comes in and helps us determine if any of these groups are different at some threshold. In this example we’ll set the threshold to the OG 0.05 thresh. Remember, a p value is the probability of showing a difference equal to or more extreme than what we have observed! This means that we will be surprised if it is less than 0.05 but not so much surprised if it’s 0.5. But first, let’s make a better plot to also show the distribution of these groups alongside the boxplots.</p>
<p><img src="https://hydroblog.netlify.com/blog/anova/anova/2021-08-17/index_files/figure-html/unnamed-chunk-4-1.png" width="960" /></p>
<p>Ok, this looks much better (IMO) and more intuitive! Now I’m unsure if there isn’t a difference 😄. Why don’t we just find out and see. Like, just take the function <code>anova()</code> and see? Well, what fun would that be! Let’s keep the suspense going…</p>
</div>
<div id="assumptions" class="section level2">
<h2>Assumptions</h2>
<p>There are some assumptions when performing ANOVA that are very similar to regression 😉.</p>
<ul>
<li>Normality within the groups distribution.</li>
<li>Independent and identically distributed (iid) assumption.</li>
<li>Groups of similar variance.</li>
</ul>
<p>To do this we’ll test these assumptions with a few functions in the stats package. For normality, we’ll use the <code>shapiro.test()</code> to test for normality with a 0.05 threshold. For iid, we’ll assume that the stations are far enough away from each other so that they are not spatially autocorrelated and we’ll assume the measurements are the same protocol. For variance, we’ll use Bartlett’s test <code>bartlett.test</code> for similar variance across groups since the groups are normally distributed.</p>
<div id="results" class="section level4">
<h4>Results</h4>
<p>We are looking for all the p values to be above 0.05. If so, then we can move on in this example. If not, then we would need to do some data transformations or some different test.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:left;">
method
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
loc_1
</td>
<td style="text-align:right;">
0.1526072
</td>
<td style="text-align:left;">
Shapiro-Wilk normality test
</td>
</tr>
<tr>
<td style="text-align:left;">
loc_2
</td>
<td style="text-align:right;">
0.6533819
</td>
<td style="text-align:left;">
Shapiro-Wilk normality test
</td>
</tr>
<tr>
<td style="text-align:left;">
loc_3
</td>
<td style="text-align:right;">
0.5656978
</td>
<td style="text-align:left;">
Shapiro-Wilk normality test
</td>
</tr>
<tr>
<td style="text-align:left;">
all groups
</td>
<td style="text-align:right;">
0.4170791
</td>
<td style="text-align:left;">
Bartlett test of homogeneity of variances
</td>
</tr>
</tbody>
</table>
<p>In our case it looks like we are fine to move on and perform ANOVA! Remember this is a toy example and in the ‘real world’ it is likely to not be so cookie-cutter but that’s fine! Don’t get shook! There are plenty of ways to correct for this, e.g. transformations, different tests (allow for non-parametric data), etc.</p>
</div>
</div>
<div id="anova" class="section level2">
<h2>ANOVA</h2>
<p>So to perform ANOVA we need to step back and remember what we are trying to find, ‘are there differences (variance) between these groups?’. To do that it would make sense to take the means of each group and the standard deviation and see how different they are right? Well let’s do that.</p>
<p><img src="https://hydroblog.netlify.com/blog/anova/anova/2021-08-17/index_files/figure-html/unnamed-chunk-6-1.png" width="960" /></p>
<p>Well, looks like there really isn’t any difference! But what does that look like mathematically? That is say, what the heck is ANOVA trying to do? Because sometimes it’s not as easy as the toy example we are looking at and we will eventually need to understand how to do it mathematically or report it instead of saying ‘well it looks the same’. Well ANOVA wants to take the groups and see if there variance is equal to each other, right? To do that, it needs to find out the variance due to attributes (SSA) and the variance due to random error (SSE). There has to be something with <em>variance</em>, right? I mean it is named analysis of <strong>variance</strong>… So, mathematically it can be expressed in the formula below where SST is the total sum of squares,</p>
<p><span class="math display">\[
\text{SST} = \text{SSA} + \text{SSE} \\ 
\sum_{i=1}^{a}\sum_{j=i}^{n_i}(x_{ij}-\mu)^2=\sum_{i=1}^{a}\sum_{j=1}^{n_i}(\bar{x_i}-\mu)^2+\sum_{i=1}^{a}\sum_{j=1}^{n_i}(x_{ij}-\bar{x_i})^2
\]</span></p>
<p>This looks really familiar, no? That’s because the parts are really similar to regression methods, e.g. the total sum of squares <span class="math inline">\(TSS = \sum_{i=1}^{n}(y_{i}-\bar{y})^2\)</span>. Remember we wanted to find out “the variance due to attributes (SSA) and the variance due to random error (SSE)” and that results in the total sum of squares for the samples. If there is a group that has more variance than the others attribute error (SSA) we should then pick that up when we compare it to the random error (SSE). Another way to think about this is graphically. Let’s look at the SSE in a graph. The image below shows the <span class="math inline">\(\sum_{j=1}^{n_i}(x_{ij}-\bar{x_i})^2\)</span> part of the equation, which shows the residuals (red lines) and then squaring and summing; however, we do this for each group and then sum! That then gives us the sum of squared errors SSE.</p>
<p><img src="resids.png" width="640" /></p>
<p>To calculate the SSA we just take the mean of each group minus the overall mean then square and sum. But, we then multiply by the number of points for <strong>one</strong> group. So in our example it would be <span class="math inline">\(12*\sum_{j=1}^{n_i}(\bar{x_i}-\mu)^2\)</span>. Ok, so how can we interpret all of this? For me, if a group is further away from the overall mean then it will increase SSA and thus influence the overall variance but might not always increase random error! This is important because the next step in ANOVA is to solve for the mean square error (MSE) and the mean square attribute (MSA), which involve ratios and can be sensitive to increases in one variable, e.g. SSA. This is the whole point of ANOVA; figure out if there is more attribute error within the group compared to the groups random error. In the equation below <span class="math inline">\(N\)</span> is equal to the number of observations and <span class="math inline">\(a\)</span> is equal to the number of attributes/groups. In our case, <span class="math inline">\(N=33\)</span> &amp; <span class="math inline">\(a=3\)</span>.</p>
<p><span class="math display">\[
\text{MSE} = \frac{SSE}{N-a} \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 
\text{MSA} = \frac{SSA}{a-1}
\]</span></p>
<p>Once we have these solved we can find the F statistic (from which we’ll get the p value) by taking the ratio of <span class="math inline">\(MSE\)</span> and <span class="math inline">\(MSA\)</span>, e.g. <span class="math inline">\(F=\frac{MSA}{MSE}\)</span>. If our F statistic is less than the critical value F statistic for a <span class="math inline">\(\alpha = 0.05\)</span> than we cannot reject the null hypothesis!</p>
</div>
<div id="finally" class="section level2">
<h2>Finally</h2>
<p>Ok, so we took a long time to get here but now we’ll actually go ahead and solve it with our data step-by-step.</p>
<p>We’ll need the overall mean and the mean of each group.</p>
<pre class="r"><code>overall_mean &lt;- wind_speed_piv %&gt;% 
  summarise(overall_mean = mean(value))

mean_of_each &lt;- wind_speed_piv %&gt;% 
  group_by(name) %&gt;% summarise(mean_of_each = mean(value)) %&gt;% ungroup</code></pre>
<p>Now we need to solve for SSA and SSE.</p>
<pre class="r"><code>ssa &lt;- wind_speed_piv %&gt;% mutate(overall_mean = overall_mean) %&gt;% 
  left_join(mean_of_each, by = &#39;name&#39;) %&gt;% 
  group_by(name)  %&gt;% slice_head(n = 1) %&gt;% ungroup() %&gt;% 
  summarise(ssa = 12*sum((mean_of_each - overall_mean)^2))

sse &lt;- wind_speed_piv %&gt;% mutate(overall_mean = overall_mean) %&gt;% 
  left_join(mean_of_each, by = &#39;name&#39;) %&gt;% 
  group_by(name) %&gt;% summarise(sse = sum((value - mean_of_each)^2)) %&gt;% 
  pull(sse) %&gt;% sum()</code></pre>
<p>Now we can solve for the MSA and MSE and thus the F statistic!</p>
<pre class="r"><code>MSA = ssa/2
MSE = sse/33

f = MSA/MSE</code></pre>
<p>Our final F statistic is 0.5596. If <span class="math inline">\(F&lt;F_{(0.05)}(2,33)\)</span> then we cannot reject the null hypothesis. <span class="math inline">\(F_{(0.05)}(2,33)=3.284\)</span> which means <span class="math inline">\(F&lt;F_{(0.05)}(2,33)\)</span> is true and we cannot reject the null! There is no statistical difference between groups at a 0.05 threshold! You can use the <code>qf()</code> to find the F critical value, e.g. <code>qf(0.95,2,33)</code>.</p>
</div>
<div id="smart-easy-way" class="section level2">
<h2>Smart easy way</h2>
<p>The smart easy way, which is the way you will always do it most likely, is to take the linear model of the data and then use the <code>anova()</code>. We’ll use this method and compare to what we got above.</p>
<pre class="r"><code>model &lt;- lm(value~name, data = wind_speed_piv)

anova(model)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: value
##           Df  Sum Sq Mean Sq F value Pr(&gt;F)
## name       2  0.7346 0.36730  0.5596 0.5767
## Residuals 33 21.6590 0.65633</code></pre>
<p>Voila, the same! The F value is the same as above and the p value is greater than 0.05 so we cannot reject the null!</p>
</div>
<div id="conclusions" class="section level2">
<h2>Conclusions</h2>
<p>Hopefully this helps with understanding ANOVA! I try to look at it by how certain variables are more sensitive than others (SSA) as well as the similarities to regression, e.g. explaining the variance in the data. If you have any comments, concerns or questions please let me know. Thanks.</p>
</div>

      </section>
      <footer class="post-footer">
        <div class="post-pagination dt w-100 mt4 mb2">
  
  
  
  
</div>

      </footer>
    </article>
    
      
<div class="post-comments pa0 pa4-l mt4">

</div>


    
  </section>
</main>
<aside class="page-sidebar" role="complementary">
                         
 


                       
 











  <img src="/blog/anova/sidebar-listing.png" class="db ma0">


<div class="blog-info ph4 pt4 pb4 pb0-l">
  

  <h1 class="f3">What is  ANOVA?</h1>
  <p class="f6 lh-copy measure">ANOVA is a way to see if there is a difference between multiple groups. Like in the graph above it&rsquo;s hard to tell by just looking at it but ANOVA gives us way to test that question &lsquo;are they different?&rsquo;.</p>
  <p class="f7 measure lh-copy i mh0-l">Written by Josh Erickson</p>


  
</div>


  
  <details open class="f6 fw7 input-reset">
  <dl class="f6 lh-copy">
    <dt class="fw7">Posted on:</dt>
    <dd class="fw5 ml0">August 17, 2021</dd>
  </dl>
  <dl class="f6 lh-copy">
    <dt class="fw7">Length:</dt>
    <dd class="fw5 ml0">8 minute read, 1561 words</dd>
  </dl>
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Categories:</dt>
    <dd class="fw5 ml0"> <a href="https://hydroblog.netlify.com/categories/r">R</a>  <a href="https://hydroblog.netlify.com/categories/hydrology">Hydrology</a>  <a href="https://hydroblog.netlify.com/categories/statistics">Statistics</a> </dd>
  </dl>
  
  
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Tags:</dt>
    <dd class="fw5 ml0"> <a href="https://hydroblog.netlify.com/tags/r">R</a> </dd>
  </dl>
  
  <dl class="f6 lh-copy">
    <dt class="fw7">See Also:</dt>
    
    <dd class="fw5 ml0"><a href="/project/wildlandhydro/">wildlandhydRo is a package that leverages USGS and SNOTEL APIs.</a></dd>
    
    <dd class="fw5 ml0"><a href="/project/explorergee/">exploreRGEE</a></dd>
    
    <dd class="fw5 ml0"><a href="/blog/anova/">ANOVA</a></dd>
    
  </dl>
</details>

</aside>
<footer class="site-footer pv4 bt b--transparent ph5" role="contentinfo">
  <nav class="db dt-l w-100">
    <p class="site-copyright f7 db dtc-l v-mid w-100 w-33-l tc tl-l pv2 pv0-l mv0 lh-copy">
      &copy; 2021 RStudio, Anywhere
      <span class="middot-divider"></span>
      Made with <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/hugo-apero/" rel="dct:source">Hugo Apéro</a></span>.
      <br />
      
Based on <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/formspree/blogophonic-hugo" rel="dct:source">Blogophonic</a></span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://formspree.io" property="cc:attributionName" rel="cc:attributionURL">Formspree</a>.
    </p>
    
    <div class="site-social-links db dtc-l v-mid w-100 w-33-l tc pv2 pv0-l mv0">
      <div class="social-icon-links" aria-hidden="true">
  
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://github.com/joshualerickson" title="github" target="_blank" rel="noopener">
      <i class="fab fa-github fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://twitter.com/joshualerickson" title="twitter" target="_blank" rel="noopener">
      <i class="fab fa-twitter fa-lg fa-fw"></i>
    </a>
  
</div>

    </div>
    
    <div class="site-links f6 db dtc-l v-mid w-100 w-67-l tc tr-l pv2 pv0-l mv0">
      
    </div>
  </nav>
  <script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</footer>

      </div>
    </body>
</html>
